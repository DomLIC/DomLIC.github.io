<!doctype html>

<html>

<head>
  <meta charset='utf-8'>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width">
  <meta property="og:image" content="preview.png" />

  <title>LIC Profile</title>

  <!-- LIC -->
  <link href='css/font.css' rel='stylesheet'>
  <link rel="stylesheet" href="css/style.css" type="text/css" media="all">
  <link rel="stylesheet" href="css/lic-styleguide.css" type="text/css" media="all">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

  <!-- Meta -->
  <meta content="LIC Developer" property="og:title">
  <meta content="LIC Developer a prototype design." name="description">
  <link rel="icon" href="../favicon.ico">
  <!-- Custom -->
  <script src="https://use.fontawesome.com/37821384dd.js"></script>

</head>

<body>
  <header>
    <div class="navbar navbar-default navbar-static-top" role="navigation" style="margin:0px;">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                  </button>
          <a href="home">
            <img src="../images/MINDA-Info.svg" style="margin-top:10px;height:60px;">
          </a>
        </div>
        <div class="collapse navbar-collapse navbar-right">
          <ul class="nav navbar-nav" style="margin:10px 0">
            <!-- <li><a href="/minda-info/docs"><span>Dominic Shooter</span> <img src="../images/me.jpeg" class="img-rounded" width="34"></a></li> -->

          </ul>
        </div>
        <!--/.nav-collapse -->

      </div>
    </div>
  </header>

  <div class="container-fluid">
    <div class="row">
      <div class="col-sm-12">
        <div id="myPaletteDiv">

          <label>Your Workforce</label>
          <ul class="list-unstyled list-inline">
            <li>
              <img src="http://placehold.it/32x32" class="img-circle img-responsive" width="32" height="32" />
            </li>
            <li>
              <img src="http://placehold.it/32x32" class="img-circle img-responsive" width="32" height="32" />
            </li>
            <li>
              <img src="http://placehold.it/32x32" class="img-circle img-responsive" width="32" height="32" />
            </li>
            <li>
              <img src="http://placehold.it/32x32" class="img-circle img-responsive" width="32" height="32" />
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12">
        <div id="myDiagramDiv" style="width:100%; height:500px"></div>
        <div class="panel panel-default">
          <div class="panel-body">
            <div class="btn-group">
              <button type="button" class="btn btn-dark-blue-stroke" onclick="myDiagram.commandHandler.zoomToFit()">Zoom to Fit</button>
            </div>
            <div class="btn-toolbar pull-right" role="toolbar" aria-label="...">
              <div class="btn-group">
                <button id="SaveButton" class="btn btn-dark-blue-stroke" onclick="save()"><i class="fa fa-code"></i> Get JSON</button>
                <button class="btn btn-dark-blue-stroke" onclick="load()"><i class="fa fa-code"></i> Update AgriOp</button>
              </div>
            </div>
          </div>
          <div class="panel-body">
            <textarea id="mySavedModel" class="form-control" style="width:100%;height:300px">
              { "class": "go.GraphLinksModel",
    "nodeDataArray": [
  {"key":1, "text":"JJ Farms Ltd", "color":"#c8dbf1", "stroke":"blue", "location":"-121.4122976400065 -35.86993158564857"},
  {"key":2, "text":"JJ Family Farm", "color":"white", "stroke":"blue", "location":"42.58861718884019 40.94098145500255"},
  {"key":3, "text":"My Herd", "color":"white", "stroke":"blue", "location":"169.7906833328184 202.9383334749978"},
  {"key":4, "text":"Good Paddock Ltd", "color":"lightgray", "stroke":"lightgray", "location":"347.43484283060445 246.20332553863108"},
  {"key":5, "text":"Vet", "color":"lightgray", "stroke":"lightgray", "location":"290.16913640922957 42.67219177019713"},
  {"key":20, "text":"Mob 1", "color":"white", "stroke":"blue", "location":"173.4460954733236 371.32320345915775"},
  {"key":21, "text":"Mob 2", "color":"white", "stroke":"blue", "location":"-4.431491295588465 241.9495423278217"},
  {"key":-2, "category":"Recycle", "loc":"125.4375078411003 776.4353615767081"}
   ],
    "linkDataArray": [
  {"from":2, "to":1},
  {"from":3, "to":2},
  {"from":4, "to":21},
  {"from":20, "to":3},
  {"from":21, "to":3},
  {"from":5, "to":3}
   ]}
      </textarea>
          </div>
        </div>
      </div>
    </div>
  </div>
  </div>

</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gojs/1.7.12/go.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/buttons.js"></script>


<script>
  // This variation on ForceDirectedLayout does not move any selected Nodes
  // but does move all other nodes (vertexes).
  function ContinuousForceDirectedLayout() {
    go.ForceDirectedLayout.call(this);
    this._isObserving = false;
  }
  go.Diagram.inherit(ContinuousForceDirectedLayout, go.ForceDirectedLayout);

  /** @override */
  ContinuousForceDirectedLayout.prototype.isFixed = function(v) {
    return v.node.isSelected;
  }

  // optimization: reuse the ForceDirectedNetwork rather than re-create it each time
  /** @override */
  ContinuousForceDirectedLayout.prototype.doLayout = function(coll) {
    if (!this._isObserving) {
      this._isObserving = true;
      // cacheing the network means we need to recreate it if nodes or links have been added or removed or relinked,
      // so we need to track structural model changes to discard the saved network.
      var lay = this;
      this.diagram.addModelChangedListener(function(e) {
        // modelChanges include a few cases that we don't actually care about, such as
        // "nodeCategory" or "linkToPortId", but we'll go ahead and recreate the network anyway.
        // Also clear the network when replacing the model.
        if (e.modelChange !== "" ||
          (e.change === go.ChangedEvent.Transaction && e.propertyName === "StartingFirstTransaction")) {
          lay.network = null;
        }
      });
    }
    var net = this.network;
    if (net === null) { // the first time, just create the network as normal
      this.network = net = this.makeNetwork(coll);
    } else { // but on reuse we need to update the LayoutVertex.bounds for selected nodes
      this.diagram.nodes.each(function(n) {
        var v = net.findVertex(n);
        if (v !== null) v.bounds = n.actualBounds;
      });
    }
    // now perform the normal layout
    go.ForceDirectedLayout.prototype.doLayout.call(this, coll);
    // doLayout normally discards the LayoutNetwork by setting Layout.network to null;
    // here we remember it for next time
    this.network = net;
  }
  // end ContinuousForceDirectedLayout



  function init() {
    if (window.goSamples) goSamples(); // init for these samples -- you don't need to call this
    var $ = go.GraphObject.make; // for conciseness in defining templates

    myDiagram = $(go.Diagram, "myDiagramDiv", // create a Diagram for the DIV HTML element
      {
        initialContentAlignment: go.Spot.Center, // center the content
        contentAlignment: go.Spot.Center, // align document to the center of the viewport
        layout: $(ContinuousForceDirectedLayout, // automatically spread nodes apart while dragging
          {
            defaultSpringLength: 30,
            defaultElectricalCharge: 100
          }),
        // do an extra layout at the end of a move
        "SelectionMoved": function(e) {
          e.diagram.layout.invalidateLayout();
        },
        "toolManager.mouseWheelBehavior": go.ToolManager.WheelZoom, // have mouse wheel events zoom in and out instead of scroll up and down
        "linkingTool.isEnabled": false, // invoked explicitly by drawLink function, below
        "linkingTool.direction": go.LinkingTool.ForwardsOnly, // only draw "from" towards "to"
        "undoManager.isEnabled": true // enable undo & redo
      });

    myDiagram.linkTemplate =
      $(go.Link, {
          routing: go.Link.Normal,
          corner: 5,
          curve: go.Link.Bezier,
          adjusting: go.Link.Stretch
        },
        new go.Binding("curviness"),
        $(go.Shape, {
          strokeWidth: 1.5,
          stroke: "#009cde"
        }),
        $(go.Shape, // the "to" end arrowhead
          {
            toArrow: "Triangle",
            fill: "#009cde",
            stroke: "#009cde"
          })
      );

    myDiagram.nodeTemplate =
      $(go.Node, "Auto", {
          desiredSize: new go.Size(90, 90),
          // rearrange the link points evenly along the sides of the nodes as links are
          // drawn or reconnected -- these event handlers only make sense when the fromSpot
          // and toSpot are Spot.xxxSides
          linkConnected: function(node, link, port) {
            if (link.fromNode !== null) link.fromNode.invalidateConnectedLinks();
            if (link.toNode !== null) link.toNode.invalidateConnectedLinks();
          },
          linkDisconnected: function(node, link, port) {
            if (link.fromNode !== null) link.fromNode.invalidateConnectedLinks();
            if (link.toNode !== null) link.toNode.invalidateConnectedLinks();
          },
          locationSpot: go.Spot.Center
        },

        new go.Binding("location", "location", go.Point.parse).makeTwoWay(go.Point.stringify),
        $(go.Shape, "Circle", {
            name: "SHAPE", // named so that changeColor can modify it
            strokeWidth: 1, // no border
            stroke: "#009cde",
            fill: "white", // default fill color
            portId: "",
            // use the following property if you want users to draw new links
            // interactively by dragging from the Shape, and re-enable the LinkingTool
            // in the initialization of the Diagram
            cursor: "pointer",
            fromLinkable: true,
            fromLinkableDuplicates: true,
            fromLinkableSelfNode: true,
            toLinkable: true,
            toLinkableDuplicates: true,
            toLinkableSelfNode: true
          },
          new go.Binding("fill", "color").makeTwoWay()
        ),

        $(go.TextBlock, {
            name: "TEXTBLOCK", // named so that editText can start editing it
            margin: 1,
            font: "9pt Booster FY",
            // use the following property if you want users to interactively start
            // editing the text by clicking on it or by F2 if the node is selected:
            //editable: true,
            overflow: go.TextBlock.OverflowEllipsis,
            textAlign: "center",
            maxLines: 3
          },
          new go.Binding("text").makeTwoWay()
        )
      );



    // a selected node shows an Adornment that includes both a blue border
    // and a row of Buttons above the node
    myDiagram.nodeTemplate.selectionAdornmentTemplate =
      $(go.Adornment, "Spot",
        $(go.Panel, "Auto",
          //selected state
          $(go.Shape, "Circle", {
            stroke: "#009cde",
            desiredSize: new go.Size(90, 90),
            strokeWidth: 2,
            fill: null
          }),
          $(go.Placeholder)
        ),

        $(go.Panel, "Vertical", {
            alignment: go.Spot.Left,
            alignmentFocus: go.Spot.Right,
          },
          $("Button", {
              click: editText,
            }, // defined below, to support editing the text of the node
            $(go.TextBlock, {
              text: "\uf040",
              verticalAlignment: go.Spot.Center,
              margin: 2
            }, {
              font: "10pt FontAwesome",
              stroke: "white",
              desiredSize: new go.Size(20, 20),
              textAlign: "center"
            }),
          ),
          $("Button", {
              actionMove: dragNewNode, // defined below, to support dragging from the button
              _dragData: {
                text: "New Place",
                color: "white"
              }, // node data to copy
              click: clickNewNode // defined below, to support a click on the button
            },
            $(go.TextBlock, {
              text: "\uf067",
              verticalAlignment: go.Spot.Center,
              margin: 2
            }, {
              font: "10pt FontAwesome",
              stroke: "white", //this sets the color boo ):
              desiredSize: new go.Size(20, 20),
              textAlign: "center"
            })
          )
        )
      );

    // dropping a node on this special node will cause the selection to be deleted;
    // linking or relinking to this special node will cause the link to be deleted
    myDiagram.nodeTemplateMap.add("Recycle",
      $(go.Node, "Auto", {
          portId: "to",
          toLinkable: true,
          deletable: false,
          layerName: "Background",
          locationSpot: go.Spot.Center
        },
        new go.Binding("location", "loc", go.Point.parse).makeTwoWay(go.Point.stringify), {
          dragComputation: function(node, pt, gridpt) {
            return pt;
          }
        }, {
          mouseDrop: function(e, obj) {
            myDiagram.commandHandler.deleteSelection();
          }

        },
        $(go.Shape, "Circle", {
          stroke: "#009cde",
          desiredSize: new go.Size(60, 60),
          strokeWidth: 2,
          fill: "#c8dbf1",
          stroke: "#001e62"
        }),
        $(go.TextBlock, {
          text: "\uf1f8",
          verticalAlignment: go.Spot.Center,
          margin: 2,
          textAlign: "center"
        }, {
          font: "20pt FontAwesome",
          stroke: "#001e62", //this sets the color boo ):
          desiredSize: new go.Size(90, 90),
          textAlign: "center"
        })
      ));

    myDiagram.nodeTemplateMap.add("Member",
      $(go.Node, "Auto", {
          portId: "to",
          toLinkable: true,
          deletable: false,
          layerName: "Background",
          locationSpot: go.Spot.Center
        },
        new go.Binding("location", "loc", go.Point.parse).makeTwoWay(go.Point.stringify), {
          dragComputation: function(node, pt, gridpt) {
            return pt;
          }
        }, {
          mouseDrop: function(e, obj) {
            // myDiagram.commandHandler.deleteSelection();
          }

        },
        $(go.Shape, "Circle", {
          stroke: "#009cde",
          desiredSize: new go.Size(32, 32),
          // strokeWidth: 2,
          fill: "#626262",
          stroke: "#001e62"
        }),
        $(go.TextBlock, {
          text: "\uf007",
          verticalAlignment: go.Spot.Center,
          margin: 2,
          textAlign: "center"
        }, {
          font: "12pt FontAwesome",
          stroke: "#fff", //this sets the color boo ):
          // desiredSize: new go.Size(90, 90),
          textAlign: "center"
        })
      ));

    //TODO This will be our workforce palette
    // initialize the Palette that is on the left side of the page
    myPalette =
      $(go.Palette, "myPaletteDiv", // must name or refer to the DIV HTML element
        {
          "animationManager.duration": 800, // slightly longer than default (600ms) animation
          nodeTemplateMap: myDiagram.nodeTemplateMap, // share the templates used by myDiagram
          model: new go.GraphLinksModel([ // specify the contents of the Palette
            {
              category: "Member",
              text: "Jess"
            },
            {
              text: "Step"
            },
            {
              text: "???",
              figure: "Diamond"
            },
            {
              category: "Member",
              text: "Joe"
            },
            {
              category: "Comment",
              text: "Comment"
            }
          ])
        });


    function editText(e, button) {
      var node = button.part.adornedPart;
      e.diagram.commandHandler.editTextBlock(node.findObject("TEXTBLOCK"));
    }

    // used by nextColor as the list of colors through which we rotate
    var myColors = ["lightgray", "lightblue", "lightgreen", "yellow", "orange", "pink"];

    // used by both the Button Binding and by the changeColor click function
    function nextColor(c) {
      var idx = myColors.indexOf(c);
      if (idx < 0) return "lightgray";
      if (idx >= myColors.length - 1) idx = 0;
      return myColors[idx + 1];
    }

    function changeColor(e, button) {
      var node = button.part.adornedPart;
      var shape = node.findObject("SHAPE");
      if (shape === null) return;
      node.diagram.startTransaction("Change color");
      shape.fill = nextColor(shape.fill);
      button["_buttonFillNormal"] = nextColor(shape.fill); // update the button too
      node.diagram.commitTransaction("Change color");
    }

    function drawLink(e, button) {
      var node = button.part.adornedPart;
      var tool = e.diagram.toolManager.linkingTool;
      tool.startObject = node.port;
      e.diagram.currentTool = tool;
      tool.doActivate();
    }

    function removeNode(data) {
      //remove node
      model.removeNodeData(nodedata);
    }

    // used by both clickNewNode and dragNewNode to create a node and a link
    // from a given node to the new node
    function createNodeAndLink(data, fromnode) {
      var diagram = fromnode.diagram;
      var model = diagram.model;
      var nodedata = model.copyNodeData(data);
      model.addNodeData(nodedata);
      var newnode = diagram.findNodeForData(nodedata);
      var linkdata = model.copyLinkData({});
      model.setFromKeyForLinkData(linkdata, model.getKeyForNodeData(fromnode.data));
      model.setToKeyForLinkData(linkdata, model.getKeyForNodeData(newnode.data));
      model.addLinkData(linkdata);
      diagram.select(newnode);
      return newnode;
    }

    //TODO This will be applied from a dialog so that the user can define the place
    function launchModal(e, button) {
      //  document.getElementById("myModal").show();
    }
    // the Button.click event handler, called when the user clicks the "N" button
    function clickNewNode(e, button) {
      var data = button._dragData;
      if (!data) return;
      e.diagram.startTransaction("Create Node and Link");
      var fromnode = button.part.adornedPart;
      var newnode = createNodeAndLink(button._dragData, fromnode);
      newnode.location = new go.Point(fromnode.location.x + 200, fromnode.location.y + 100);
      e.diagram.commitTransaction("Create Node and Link");
    }

    // the Button.actionMove event handler, called when the user drags within the "N" button
    function dragNewNode(e, button) {
      var tool = e.diagram.toolManager.draggingTool;
      if (tool.isBeyondDragSize()) {
        var data = button._dragData;
        if (!data) return;
        e.diagram.startTransaction("button drag"); // see doDeactivate, below
        var newnode = createNodeAndLink(data, button.part.adornedPart);
        newnode.location = e.diagram.lastInput.documentPoint;
        // don't commitTransaction here, but in tool.doDeactivate, after drag operation finished
        // set tool.currentPart to a selected movable Part and then activate the DraggingTool
        tool.currentPart = newnode;
        e.diagram.currentTool = tool;
        tool.doActivate();
      }
    }

    // using dragNewNode also requires modifying the standard DraggingTool so that it
    // only calls commitTransaction when dragNewNode started a "button drag" transaction;
    // do this by overriding DraggingTool.doDeactivate:
    var tool = myDiagram.toolManager.draggingTool;
    tool.doDeactivate = function() {
      // commit "button drag" transaction, if it is ongoing; see dragNewNode, above
      if (tool.diagram.undoManager.nestedTransactionNames.elt(0) === "button drag") {
        tool.diagram.commitTransaction();
      }
      go.DraggingTool.prototype.doDeactivate.call(tool); // call the base method
    };



    // The following code overrides GoJS focus to stop the browser from scrolling
    // the page when either the Diagram or Palette are clicked or dragged onto.

    function customFocus() {
      var x = window.scrollX || window.pageXOffset;
      var y = window.scrollY || window.pageYOffset;
      go.Diagram.prototype.doFocus.call(this);
      window.scrollTo(x, y);
    }

    myDiagram.doFocus = customFocus;
    myPalette.doFocus = customFocus;


    myDiagram.model = new go.GraphLinksModel(
      [{
          "key": 1,
          "text": "JJ Farms Ltd",
          "color": "#c8dbf1",
          "stroke": "blue",
          "location": "-121.4122976400065 -35.86993158564857"
        },
        {
          "key": 2,
          "text": "JJ Family Farm",
          "color": "white",
          "stroke": "blue",
          "location": "42.58861718884019 40.94098145500255"
        },
        {
          "key": 3,
          "text": "My Herd",
          "color": "white",
          "stroke": "blue",
          "location": "169.7906833328184 202.9383334749978"
        },
        {
          "key": 4,
          "text": "Good Paddock Ltd",
          "color": "lightgray",
          "stroke": "lightgray",
          "location": "347.43484283060445 246.20332553863108"
        },
        {
          "key": 5,
          "text": "Vet",
          "color": "lightgray",
          "stroke": "lightgray",
          "location": "290.16913640922957 42.67219177019713"
        },
        {
          "key": 20,
          "text": "Mob 1",
          "color": "white",
          "stroke": "blue",
          "location": "173.4460954733236 371.32320345915775"
        },
        {
          "key": 21,
          "text": "Mob 2",
          "color": "white",
          "stroke": "blue",
          "location": "-4.431491295588465 241.9495423278217"
        },
        {
          "key": -2,
          "category": "Recycle",
          "loc": "-170.07284169263374 384.7128370935226"
        }
      ], [{
          "from": 2,
          "to": 1
        },
        {
          "from": 3,
          "to": 2
        },
        {
          "from": 4,
          "to": 21
        },
        {
          "from": 20,
          "to": 3
        },
        {
          "from": 21,
          "to": 3
        },
        {
          "from": 5,
          "to": 3
        }
      ]);



    myDiagram.findNodeForKey(1).isSelected = true;
  } //end init

  // Show the diagram's model in JSON format
  function save() {
    document.getElementById("mySavedModel").value = myDiagram.model.toJson();
  }

  function load() {
    myDiagram.model = go.Model.fromJson(document.getElementById("mySavedModel").value);
  }

  init();
</script>

</html>
